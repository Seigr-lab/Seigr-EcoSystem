syntax = "proto3";

package seigr;

import "file_metadata.proto"; // Importing TemporalLayer from file_metadata.proto

// Message for tracking temporal history of modifications or rollbacks
message TemporalHistory {
    string history_id = 1;                      // Unique ID for this temporal history entry
    repeated TemporalLayer temporal_layers = 2; // List of temporal layers representing historical snapshots
    string created_by = 3;                      // ID of the user or system that created the history
    string created_at = 4;                      // Timestamp of the history record creation
    string last_modified_at = 5;                // Timestamp of the last modification to the history
    map<string, string> metadata = 6;           // Metadata for additional context or usage, such as source
}

// Message for lineage tracking of data within the system, capturing hierarchical relationships
message LineageTracking {
    string lineage_id = 1;                     // Unique identifier for the lineage tracking record
    repeated string ancestor_hashes = 2;       // List of hashes for all ancestor states in lineage
    repeated string descendant_hashes = 3;     // List of hashes for all descendant states in lineage
    string original_creation = 4;              // Timestamp of the original data creation
    map<string, string> lineage_metadata = 5;  // Metadata for additional lineage context, e.g., origin
    string integrity_check = 6;                // Hash or checksum for lineage integrity verification
    bool archived = 7;                         // Flag indicating if the lineage is archived and immutable
}

// Message for retrieving a specific temporal snapshot based on a timestamp or criteria
message TemporalSnapshotRequest {
    string request_id = 1;                     // Unique identifier for the snapshot request
    string segment_id = 2;                     // ID of the segment to retrieve a snapshot for
    string target_timestamp = 3;               // Timestamp of the desired snapshot state
    bool exact_match = 4;                      // True if only an exact timestamp match is acceptable
    string requested_by = 5;                   // ID of the user or system requesting the snapshot
    map<string, string> request_metadata = 6;  // Additional metadata for request context, e.g., priority level
}

// Message to represent the result of a snapshot retrieval, with retrieval details
message TemporalSnapshotResponse {
    string request_id = 1;                     // Matches the request ID of the snapshot request
    TemporalLayer snapshot_layer = 2;          // Retrieved temporal layer representing the snapshot
    bool success = 3;                          // Indicates if retrieval was successful
    string error_message = 4;                  // Error message if retrieval failed
    map<string, string> response_metadata = 5; // Metadata for response context, e.g., response time
    string retrieved_timestamp = 6;            // Timestamp of the snapshot that was retrieved
}
